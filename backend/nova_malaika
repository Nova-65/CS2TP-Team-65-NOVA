CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    full_name VARCHAR(84) NOT NULL,
    email VARCHAR(120) NOT NULL UNIQUE,
    password VARCHAR(64) NOT NULL,
    phone_number VARCHAR(12),
    role ENUM('customer', 'admin') DEFAULT 'customer',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);


CREATE TABLE basket (
    basket_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NULL,
    session_id CHAR(36) NULL,
    status ENUM('active', 'converted', 'abandoned') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);


CREATE TABLE basket_items (
    basket_item_id INT AUTO_INCREMENT PRIMARY KEY,
    basket_id INT NOT NULL,
    size_id INT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    line_total DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    UNIQUE (basket_id, size_id),

    CONSTRAINT fk_basket_items_basket
        FOREIGN KEY (basket_id) REFERENCES basket(basket_id)
        ON DELETE CASCADE
);

-- add this when product_versions is created BY FUAD
--ALTER TABLE basket_items 
--ADD CONSTRAINT fk_basket_items_size 
--FOREIGN KEY (size_id) REFERENCES product_versions(size_id);

